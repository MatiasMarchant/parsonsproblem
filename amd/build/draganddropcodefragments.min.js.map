{"version":3,"file":"draganddropcodefragments.min.js","sources":["../src/draganddropcodefragments.js"],"sourcesContent":["export const init = (questionid, answerid) => {\n    let dragItem = null;\n    let draggedOver = null;\n    let initX = null;\n    let endX = null;\n    let leavingColumn = null;\n    let enteringColumn = null;\n    let content = \"\";\n    let leftColumn = document.getElementById('column' + questionid + '0');\n    let rightColumn = document.getElementById('column' + questionid + '1');\n    let answerObject = document.getElementById(answerid);\n\n    leftColumn.addEventListener('dragover', dragOverColumn);\n    leftColumn.addEventListener('dragenter', dragEnterColumn);\n    leftColumn.addEventListener('dragleave', dragLeaveColumn);\n    rightColumn.addEventListener('dragover', dragOverColumn);\n    rightColumn.addEventListener('dragenter', dragEnterColumn);\n    rightColumn.addEventListener('dragleave', dragLeaveColumn);\n    let neighborhood = leftColumn.childNodes;\n    let answerneighborhood = rightColumn.childNodes;\n    neighborhood.forEach(\n        function(codeFragment) {\n            codeFragment.draggable = true;\n            codeFragment.currentIndentation = 0;\n            codeFragment.addEventListener('dragstart', dragStart);\n            codeFragment.addEventListener('dragend', dragEnd);\n            codeFragment.addEventListener('dragover', dragOver);\n            if (codeFragment.classList.contains(\"sortable-choice-parent\")) {\n                let counter = 0;\n                codeFragment.childNodes.forEach(\n                    function(choice) {\n                        if (counter === 0) {\n                            choice.classList.add('chosen-choice');\n                        }\n                        choice.addEventListener('click', clickChoice);\n                        counter++;\n                    }\n                );\n            }\n        },\n    );\n\n    /**\n     * This event triggers when the student clicks a choice in a visually paired choice.\n     * It removes the class chosen-choice to all the same codeFragment choices\n     * then adds the class chosen-choice to the clicked choice.\n     */\n    function clickChoice() {\n        this.parentNode.childNodes.forEach(\n            function(choice) {\n                choice.classList.remove('chosen-choice');\n            }\n        );\n        this.classList.add('chosen-choice');\n        updateAnswer();\n    }\n\n    /**\n     * This function triggers whenever a sortable item gets clicked for dragging.\n     * It sets the value of initX for future indentation purposes and sets the variable\n     * dragItem to the sortable item being dragged.\n     * @param {Event} e - Click event that triggers item drag.\n     */\n    function dragStart(e) {\n        initX = e.clientX;\n        dragItem = this;\n    }\n\n    /**\n     * This function triggers whenever dragging stops, it updates the final answer getting uploaded when the student ends the quiz.\n     */\n    function dragEnd() {\n        dragItem = null;\n        updateAnswer();\n    }\n\n    /**\n     * This function updates the answer object considering all the info on the answer column\n     */\n    function updateAnswer() {\n        answerObject.value = \"\";\n        answerneighborhood.forEach(line => {\n            if (line.classList.contains(\"sortable-choice-parent\")) {\n                line.childNodes.forEach(\n                    function(choice) {\n                        if (choice.classList.contains(\"chosen-choice\")) {\n                            content = choice.innerHTML;\n                        }\n                    }\n                );\n            } else {\n                content = line.innerHTML;\n            }\n            let lines = content.split(/\\r\\n|\\r|\\n/g);\n            lines.forEach(function(contentline) {\n                answerObject.value =\n                answerObject.value + \"    \".repeat(line.currentIndentation) + decodeHtml(contentline) + \"\\r\\n\";\n            });\n            answerObject.value = answerObject.value.slice(0, -2); // Remove last \\r\\n\n            answerObject.value = answerObject.value + '|/';\n            content = \"\";\n        });\n        answerObject.value = answerObject.value.slice(0, -2); // Remove last '|/'\n    }\n\n    /**\n     * This function returns an HTML-decoded version of the parameter html\n     * @param {String} html - HTML encoded string\n     * @returns {String} - HTML decoded string\n     */\n    function decodeHtml(html) {\n        var txt = document.createElement(\"textarea\");\n        txt.innerHTML = html;\n        return txt.value;\n    }\n\n    /**\n     * This function triggers whenever a sortable item is being dragged over another sortable item.\n     * It sets the variable draggedOver to the sortable item being dragged over.\n     * It sets the position of the item being dragged to the position of the item being dragged over,\n     * and pushes the item being dragged over up or down depending of the initial position of the item being dragged.\n     * @param {Event} e - Click event that triggers item drag.\n     */\n    function dragOver(e) {\n        e.preventDefault();\n        draggedOver = e.target;\n        // If draggedOver is a visually paired choice, then the choices are the neighborhood and throws errors when calling moveItem\n        if (draggedOver.classList.contains(\"sortable-choice\")) {\n            draggedOver = draggedOver.parentNode;\n        }\n        moveItem(draggedOver.parentNode.childNodes);\n    }\n\n\n    /**\n     * This function is called whenever an item gets dragged in the valid area (background).\n     * It calls the function indentationSpacesOver to manage indentation spaces of the item being dragged.\n     * @param {Event} e - Click event that triggers item drag.\n     */\n    function dragOverColumn(e) {\n        e.preventDefault();\n        indentationSpacesOver(e);\n    }\n\n    /**\n     * This function gets called whenever an object gets dragged into one of both columns.\n     * When a codeFragment enters another column it gets added as a child of the parent node (column)\n     * @param {*} e - Click event that triggers item drag.\n     */\n    function dragEnterColumn(e) {\n        enteringColumn = this;\n        if (leavingColumn !== null && leavingColumn !== enteringColumn) { // Esto quiere decir que se salió de una col y entró a otr\n            if (this.isSameNode(leftColumn)) {\n                leftColumn.appendChild(dragItem);\n                initX = e.clientX;\n                dragItem.currentIndentation = 0;\n                dragItem.style.marginLeft = \"0px\";\n            } else if (this.isSameNode(rightColumn)) {\n                rightColumn.appendChild(dragItem);\n                initX = e.clientX;\n                dragItem.currentIndentation = 0;\n                dragItem.style.marginLeft = \"0px\";\n            }\n        }\n        leavingColumn = null;\n        enteringColumn = null;\n    }\n\n    /**\n     * This function gets called whenever an object gets dragged out of one of both columns.\n     * It sets the variable leavingColumn to the column that has a codeFragment leaving.\n     * @param {*} e - Click event that triggers item drag.\n     */\n    function dragLeaveColumn() {\n        leavingColumn = this;\n    }\n\n    /**\n     * This function registers the mouse's X coordinate in order to calculate if the item being dragged\n     * should be indented.\n     * @param {Event} e - Click event that triggers item drag.\n     */\n    function indentationSpacesOver(e) {\n        endX = e.clientX;\n        if (endX >= initX + 50) { // Indentations to the right\n            let indentations = Math.floor((endX - initX) / 50);\n            dragItem.style.marginLeft = (((dragItem.currentIndentation + indentations) * 50)) + \"px\";\n            dragItem.currentIndentation = dragItem.currentIndentation + indentations;\n            initX = endX;\n        } else {\n            let indentations = Math.floor((Math.abs(initX - endX)) / 50);\n            if (dragItem.currentIndentation - indentations <= 0) {\n                dragItem.style.marginLeft = \"0px\";\n                dragItem.currentIndentation = 0;\n            } else if (indentations >= 1) { // Indentations to the left\n                dragItem.style.marginLeft = (((dragItem.currentIndentation - indentations) * 50)) + \"px\";\n                dragItem.currentIndentation = dragItem.currentIndentation - indentations;\n                initX = endX;\n            }\n        }\n    }\n\n    /**\n     * It sets the position of the item being dragged to the position of the item being dragged over,\n     * and pushes the item being dragged over up or down depending of the initial position of the item being dragged.\n     * @param {NodeList} neighborhood - NodeList containing draggable codeFragment Nodes\n     */\n    function moveItem(neighborhood) {\n        if (dragItem != draggedOver) {\n            let currentpos = 0;\n            let droppedpos = 0;\n            for (let it = 0; it < neighborhood.length; it++) {\n                if (dragItem == neighborhood[it]) { currentpos = it; }\n                if (draggedOver == neighborhood[it]) { droppedpos = it; }\n            }\n            if (currentpos < droppedpos) { // Whenever dragItem item was higher than draggedOver item\n                dragItem.parentNode.insertBefore(dragItem, draggedOver.nextSibling);\n            } else { // Whenever dragItem item was lower than draggedOver item\n                dragItem.parentNode.insertBefore(dragItem, draggedOver);\n            }\n        }\n    }\n};"],"names":["questionid","answerid","dragItem","draggedOver","initX","endX","leavingColumn","enteringColumn","content","leftColumn","document","getElementById","rightColumn","answerObject","addEventListener","dragOverColumn","dragEnterColumn","dragLeaveColumn","neighborhood","childNodes","answerneighborhood","clickChoice","parentNode","forEach","choice","classList","remove","add","updateAnswer","dragStart","e","clientX","this","dragEnd","value","line","contains","innerHTML","split","contentline","html","txt","repeat","currentIndentation","createElement","slice","dragOver","preventDefault","target","currentpos","droppedpos","it","length","insertBefore","nextSibling","moveItem","indentations","Math","floor","style","marginLeft","abs","indentationSpacesOver","isSameNode","appendChild","codeFragment","draggable","counter"],"mappings":"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"}